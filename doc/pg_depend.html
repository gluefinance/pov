<html>
    <head>
        <title>pg_depend problem</title>
    </head>
    <body>
        <p>In the example, pg_depend.sql, we want to reach the following conclusions in an algorithmic way, only by using pg_depend as in-data:</p>
        <ol>
            <li>table t1, function f1, sequence s1 have no dependencies, other than the public schema</li>
            <li>table t2 depends on t1 and table t3 depends on f1</li>
            <li>view v1 depends on t1 and view v2 depends on t2</li>
            <li>view v3 depends on both v1 and v2</li>
            <li>view v4 depends on v3 and f1</li>
        </ol>
        <p>The topological tree automatically generated from the data in pg_depend is presented in pg_depend.dot, pg_depend.svg and pg_depend.png.</p>
        <p>The actual topological tree (possible order of creation) created manually is presented in pg_depend_actual.dot, pg_depend_actual.svg and pg_depend_actual.png.</p>
        <p>The automatically created objects, such as primary key indexes, constraints and triggers, have been ignored in this graph, as they are implicitly created when creating the "base objects".</p>
        <p>CHALLENGE: Define a general algorithm taking ONLY the pg_depend data as input, generating a valid topological directional graph, including at least the nodes in pg_depend_actual.dot, but might as well include all nodes, although it is not necessary, it's certainly won't hurt.</p>
        <p>It will be necessary to look not only at the nodes (objects) and edges (obj->refobj), but also the deptype for each edge.</p>
        <div>
            <table>
                <tr><th>file</th><th>description</th></tr>
                <tr><td><a href="pg_depend/pg_depend.sql">pg_depend/pg_depend.sql</a></td><td>Basic database model.</td></tr>
                <tr><td><a href="pg_depend/pg_depend.dot">pg_depend/pg_depend.dot</a></td><td>Digraph in DOT language (plaintext format), generated automatically only by using data from pg_data.</td></tr>
                <tr><td><a href="pg_depend/pg_depend.png">pg_depend/pg_depend.png</a></td><td>PNG generated using GraphViz with pg_depend.dot as input</td></tr>
                <tr><td><a href="pg_depend/pg_depend.svg">pg_depend/pg_depend.svg</a></td><td>SVG generated using GraphViz with pg_depend.dot as input</td></tr>
                <tr><td><a href="pg_depend/pg_depend_actual.dot">pg_depend/pg_depend_actual.dot</a></td><td>Digraph in DOT language (plaintext format), generated manually, shows the actual possible order of creation, only including the "base objects".</td></tr>
                <tr><td><a href="pg_depend/pg_depend_actual.png">pg_depend/pg_depend_actual.png</a></td><td>PNG generated using GraphViz with pg_depend_actual.dot as input</td></tr>
                <tr><td><a href="pg_depend/pg_depend_actual.svg">pg_depend/pg_depend_actual.svg</a></td><td>SVG generated using GraphViz with pg_depend_actual.dot as input</td></tr>
            </table>
        </div>
        <div>
            <pre>

Result of tsort:
* sequence s1 1259.23359
* function f1(integer) 1255.23358
* table t3 1259.23371
* table t1 1259.23353
* view v1 1259.23378
* table t2 1259.23361
* view v2 1259.23382
* view v3 1259.23386
* view v4 1259.23390

All objects:
 constraint t3_pkey on table t3 2606.23377
 index t3_pkey 1259.23376
 schema public 2615.2200
* sequence s1 1259.23359
 type s1 1247.23360
 default for table t3 column id 2604.23374
* function f1(integer) 1255.23358
 constraint t3_id_check on table t3 2606.23375
* table t3 1259.23371
 type t3 1247.23373
 type t3[] 1247.23372
 constraint t1_pkey on table t1 2606.23357
 index t1_pkey 1259.23356
* table t1 1259.23353
 type t1 1247.23355
 type t1[] 1247.23354
 constraint t2_id_fkey on table t2 2606.23366
 trigger RI_ConstraintTrigger_23369 on table t1 2620.23369
 trigger RI_ConstraintTrigger_23367 on table t2 2620.23367
 trigger RI_ConstraintTrigger_23370 on table t1 2620.23370
 trigger RI_ConstraintTrigger_23368 on table t2 2620.23368
 rule _RETURN on view v1 2618.23381
* view v1 1259.23378
 type v1 1247.23380
 type v1[] 1247.23379
 constraint t2_pkey on table t2 2606.23365
* table t2 1259.23361
 type t2 1247.23363
 type t2[] 1247.23362
 rule _RETURN on view v2 2618.23385
* view v2 1259.23382
 type v2 1247.23384
 type v2[] 1247.23383
 rule _RETURN on view v3 2618.23389
* view v3 1259.23386
 rule _RETURN on view v4 2618.23393
* view v4 1259.23390
 type v4 1247.23392
 type v4[] 1247.23391
 type v3 1247.23388
 type v3[] 1247.23387
 index t2_pkey 1259.23364
            </pre>
        </div>
    </body>
</html>
